Ext.onReady(function(){var menuString=document.getElementById("menuString").value;menuString="["+menuString+"]";var selected;var Tree=Ext.tree;var tree=new Tree.TreePanel({el:"treePanel",title:"",autoScroll:true,checkModel:"extCascade",onlyLeafCheckable:false,animate:false,enableDD:false,rootVisible:false,containerScroll:true,collapseMode:"mini",loader:new Tree.TreeLoader({dataUrl:"/portalConfig.do",baseAttrs:{uiProvider:Ext.ux.TreeCheckNodeUI}})});var root=new Tree.AsyncTreeNode({text:"Ext JS",id:"source",children:eval(menuString)});tree.setRootNode(root);tree.on("check",function(node,checked){var checkedNodes=tree.getChecked();var selectedNodeIds="";var selectedNodeTexts="";if(checkedNodes!=null&&checkedNodes.length>0){for(var i=0;i<checkedNodes.length;i++){var checkedNode=checkedNodes[i];var parentNode=checkedNode.parentNode;if(checkedNode.leaf&&parentNode&&parentNode.id!="000"&&selectedNodeIds.indexOf(parentNode.id)<0){selectedNodeIds+=parentNode.id+"-";selectedNodeTexts+=parentNode.text+"|";var childNodes=parentNode.childNodes;if(childNodes&&childNodes.length>0){for(var j=0;j<childNodes.length;j++){if(childNodes[j].attributes.checked){selectedNodeIds+=childNodes[j].id+","}}selectedNodeIds=selectedNodeIds.substr(0,selectedNodeIds.length-1)+"|"}}}}document.getElementById("selectedNodeId").value=selectedNodeIds;document.getElementById("selectedNodeText").value=selectedNodeTexts},tree);tree.render();if(root.firstChild!=null){root.firstChild.expand();var checkedQueueIds=document.getElementById("selectedNodeId").value;root.firstChild.eachChild(function(child){listNode(child,checkedQueueIds)})}});function listNode(G,D){if(G!=null){G.expand();var C=false;var B=false;var A=true;for(var F=0;F<G.childNodes.length;F++){var E=G.childNodes[F];if(E==null){continue}if(D.indexOf(E.id)>=0){C=true;E.getUI().checkbox.checked=true;E.attributes.checked=true}else{E.getUI().checkbox.checked=false;E.attributes.checked=false;A=false}E.expand();if(E.childNodes.length>0){var H=listNode(E,D);if(H){B=true}}}if(C||B){G.expand();if(A){G.getUI().checkbox.checked=true;G.attributes.checked=true}else{G.getUI().checkbox.checked=false;G.attributes.checked=false}return true}else{G.collapse();return false}}}
